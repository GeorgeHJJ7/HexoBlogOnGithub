---
title: 事务的ACID和四个隔离级别
date: 2016-11-26 00:34:15
tags: 
 - 事务
 - 数据库
reward: true
---

在实际的业务场景中，并发读写引出了和事务控制的需求。优秀的事务处理能力是关系型数据库（特别是oracle等商用RDBMS）相对于正当风口的NoSQL数据库的一大亮点。但这也从另一方面说明了事务控制的复杂性——正因为过于复杂，大部分NoSQL都没提供事务支持或只提供部分事务支持。

<!--more-->

# ACID

一个数据库事务是`"一个被视为单一的工作单元的操作序列"`。一个良好的事务处理系统，必须具备四个标准特性：  

1. **原子性（Atomicity）**：一个事务必须被视为一个不可分割的最小工作单元，整个事务中的所有操作要么全部提交成功，要么全部失败回滚，对于一个事务来说，不可能只执行其中的一部分操作，这就是事务的原子性
2. **一致性（Consistency）**：数据库总是从一个一致性的状态转换到另一个一致性的状态。（在前面的例子中，一致性确保了，即使在执行第三、四条语句之间时系统崩溃，支票账户中也不会损失200美元，因为事务最终没有提交，所以事务中所做的修改也不会保存到数据库中。）
3. **隔离性（Isolation）**：通常来说，一个事务所做的修改在最终提交以前，对其他事务是不可见的。
4. **持久性（Durability）**：一旦事务提交，则其所做的修改不会永久保存到数据库。（此时即使系统崩溃，修改的数据也不会丢失。持久性是个有占模糊的概念，因为实际上持久性也分很多不同的级别。有些持久性策略能够提供非常强的安全保障，而有些则未必，而且不可能有能做到100%的持久性保证的策略。）

以上四个特性就是常说的**ACID**。其中，**隔离性的四个级别**是面试常考点。  

# 隔离性的四个级别

## READ UNCOMMITTED（未提交读）
在READ UNCOMMITTED级别，事务中的修改，即使没有提交，对其他事务也都是可见的。事务可以读取未提交的数据，这也被称为脏读（Dirty Read）。这个级别会导致很多问题，从性能上来说，READ UNCOMMITTED不会比其他的级别好太多，但却缺乏其他级别的很多好处，除非真的有非常必要的理由，在实际应用中一般很少使用。  
## READ COMMITTED（提交读）
大多数数据库系统的默认隔离级别都是READ COMMTTED（但MySQL不是）。READ COMMITTED满足前面提到的隔离性的简单定义：一个事务开始时，只能"看见"已经提交的事务所做的修改。换句话说，一个事务从开始直到提交之前，所做的任何修改对其他事务都是不可见的。这个级别有时候叫做不可重复读（nonrepeatble read），因为两次执行同样的查询，可能会得到不一样的结果。  
## REPEATABLE READ(可重复读)
REPEATABLE READ解决了脏读的问题。该隔离级别保证了在同一个事务中多次读取同样记录结果是一致的。但是理论上，可重复读隔离级别还是无法解决另外一个幻读（Phantom Read）的问题。所谓幻读，指的是当某个事务在读取某个范围内的记录时，另一个事务又在该范围内插入了新的记录，当之前的事务再次读取该范围的记录时，会产生幻行（Phantom Row）。InnoDB和XtraDB存储引擎通过多版本并发控制（MVCC，Multiversion Concurrency Control）解决了幻读的问题。  
## SERIALIZABLE（串行化）
SERIALIZABLE是最高的隔离级别。它通过强制事务串行执行，避免了前面说的幻读的问题。简单来说，SERIALIZABLE会在读取每一行数据都加锁，所以可能导致大量的超时和锁争用问题。实际应用中也很少用到这个隔离级别，只有在非常需要确保数据的一致性而且可以接受没有并发的情况下，才考虑采用该级别。  
# 隔离级别的总结
打钩说明该隔离级别还存在这种情况，打X代表该隔离级别已经解决了这种情况：  

| 隔离级别  						| 脏读  | 不可重复读 | 幻读 |
|:--------------------------- |:----:|:----:|:----:|
| 读未提交（Read uncommitted）	| Y    | Y    | Y    |
| 读已提交（Read committed）		| X    | Y    | Y    |
| 可重复读（Repeatable read）	| X    | X    | Y    |
| 可串行化（Serializable）		| X    | X    | X    |

>参考：  
[MySQL ACID及四种隔离级别的解释](http://www.cnblogs.com/xuanzhi201111/p/4103696.html)  
